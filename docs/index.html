<!DOCTYPE html>
<html lang="de">
<head>
	<meta http-equiv="Content-Security-Policy-Report-Only" content="default-src: 'unsafe-eval' 'unsafe-inline'">
  <meta charset="utf-8">
  <title></title>
  <link href="style.css" rel="stylesheet" />
</head>
<body>
  <h1 id="headline">Scan</h1>
  <video id="video-canvas" autoplay="true"></video>
  <script type="module">
    import ky from 'https://cdn.jsdelivr.net/npm/ky@latest/index.js';
    import QrScanner from './qr-scanner.min.js';

    const videoElement = document.getElementById('video-canvas');
    const headlineElement = document.getElementById('headline');
    var scans = 0;

    const escapeHtml = unsafe => {
        return unsafe
             .replace(/&/g, "&amp;")
             .replace(/</g, "&lt;")
             .replace(/>/g, "&gt;")
             .replace(/"/g, "&quot;")
             .replace(/'/g, "&#039;");
     }

    (async () => {
      //const parsed = await ky('https://api.testbefund.de/corona-test-case').json();

      console.dir(parsed);
      //=> 'delectus aut autem
    })();

    if (navigator.mediaDevices.getUserMedia) {
      navigator.mediaDevices.getUserMedia({video: true})
        .then(stream => {
          videoElement.srcObject = stream;
          const scanner = new QrScanner(videoElement, res => headline.innerText = `Scan #${scans++}: ${escapeHtml(res)}`);
          scanner.start();
        })
        .catch(err => console.log('stream-err: ', err));
    }
  </script>
</body>
</html>
